function handleData(a,e,s){if($("#resultOfSearch").empty(),a.length>0)$.each(a,function(a,e){var s="",t="",o="",r="",l="";null!=e.connect&&(s="<hr><p><b>Colaborador associado</b></p><p><b>Colaborador:</b>"+e.connect[0].value+" <b>Matrícula:</b>  "+e.connect[0].id+"  <b>Situação:</b> "+e.connect[0].DESSIT+"</p>"),t=0==e.state.length?'<button type="button" class="close glyphicon glyphicon-pencil status-ben" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button><p><b>Estado:</b>Sem definição</p><p><b>Descrição:</b>Sem definição</p>':'<button type="button" class="close glyphicon glyphicon-pencil status-ben" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button><p><b>Estado:</b>'+e.state[0].state+"</p><p><b>Descrição:</b>"+e.state[0].description+"</p><p><b>Observação:</b>"+e.state[0].desc+"</p>",0==e.keys.length?o="<p>Nenhuma licença associada</p>":(o='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">',$.each(e.keys,function(a,e){vencimento="Vitalício",null!=e.maturity_date&&(vencimento=DateUsTODateBr(e.maturity_date)),o+="<div class='panel panel-default'><div class='panel-heading' role='tab' id='headin"+e.id+"'><h4 class=\"panel-title\"><a role='button' data-toggle='collapse'  href='#"+e.id+"' aria-expanded='true' aria-controls='"+e.id+"'>"+e.name+"/"+e.model+"</a></h4></div><div id='"+e.id+'\' class="panel-collapse collapsing" role="tabpanel" aria-labelledby=\'headin'+e.id+"'><div class=\"panel-body\"><span class='idkey' style='display: none' >"+e.keyid+"</span><b>Chave:</b>"+e.key+"  - <b>QTD</b> :"+e.quantity+"/<b>Em uso: </b>"+e.in_use+"<b> - Vencimento: </b>"+vencimento+" <button class='btn btn-xs remove-key' title='Dissociar o item da licença.' ><span class='glyphicon glyphicon-resize-full'></span> </button></div></div></div>"}),o+="</div>"),r+=e.ASSOC?'<button class="btn btn-danger dissociar-colaborador" type="button"><span class=\'glyphicon glyphicon-user\'></span> Desassociar</button>':'<button class="btn btn-default associar-colaborador" type="button"><span class=\'glyphicon glyphicon-user\'></span> Associar</button>',l=0==e.EMPRST&&0==e.ASSOC?'<button class="btn btn-success emprestimo" type="button"><span class=\'glyphicon glyphicon-transfer\'></span> Emprestimo</button>':1==e.ASSOC?'<button class="btn btn-success emprestimo" type="button" disabled><span class=\'glyphicon glyphicon-transfer\'></span> Emprestimo</button>':'<button class="btn btn-warning devolucao" type="button"><span class=\'glyphicon glyphicon-retweet\'></span> Devolução</button>';var n='<div class="panel panel-default"><div class="panel-heading cod-bem">'+e.CODBEM+"</div><div class='result-emp' style='display: none'>"+e.CODEMP+'</div><div class="panel-body"><p><b>Data Aquisição:</b> '+e.DATAQI+" </p><p><b>Item:</b> "+e.DESBEM+" </p><p><b>Descrição:</b> "+e.DESESP+" </p><p><b>Empresa:</b> "+e.NOMEMP+" </p><hr>"+t+s+"<hr>"+o+'</div><div class=\'panel-footer\'> <div class="btn-group"><button class="btn btn-primary localizacoes" type="button"><span class=\'glyphicon glyphicon-map-marker\'></span>Localizações</button>'+r+l+"</div></div></div>";$("#resultOfSearch").append(n)});else{var t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> Nenhum item encontrado!</div>';$("#resultOfSearch").append(t)}$("#buttonSearch").empty(),$("#buttonSearch").append('<span class="glyphicon glyphicon-search"></span> Pesquisar')}function historyLocations(a,e,s){$("#historicoLocalizacoes").empty(),$.each(a.Locations,function(a,e){var s='<div class="panel panel-default"><div class="panel-body"><p><b>Data Aquisição:</b> '+e.DATLOC+" </p><p><b>Descrição:</b> "+e.DESLOC+" </p></div></div>";$("#historicoLocalizacoes").append(s)}),$("#historyFinancialList").empty(),$.each(a.MovFinancial,function(a,e){var s='<div class="panel panel-default"><div class="panel-body"><p><b>Data Movimentação:</b> '+e.DATMOV+" </p><p><b>Descrição:</b> "+e.DESTNS+" </p><p><b>Centro Custo:</b> "+e.CODCCU+" </p></div></div>";if(90804==e.CODTNS){var t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> Esse item foi vendido!.</div>';$("#search").after(t)}90815!=e.CODTNS&&$("#historyFinancialList").append(s)})}function Emprestimo(a,e){$.ajax({url:a,data:e,type:"post",success:function(s){var t="";1==s.erro?t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg:0==s.erro&&($(".emprestimo-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),t='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg),a=a.replace("emprestimo","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(t)}}).fail(ErroConnect)}function Devolucao(a,e){$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(s){var t="";1==s.error?t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>":0==s.error&&($(".devolucao-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),t='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>"),a=a.replace("devolucao","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(t)}}).fail(ErroConnect)}function DevolucaoDados(a,e){$.ajax({url:a+"/"+e.codbem+"/"+e.codbememp,type:"get",data:e,dataType:"json",success:function(a){$(".info-devolucao").remove();var e="<div class='panel panel-default info-devolucao'><div class='panel-body'><p><b>Data empréstimo: </b>"+a[0].data_out+"</p><p><b>Colaborador: </b>"+a[0].colaborador.value+"</p><p><b>Situação do colaborador: </b>"+a[0].colaborador.DESSIT+"</p><p><b>Obs saída: </b>"+(""==a[0].obs_saida?"Sem observação":a[0].obs_saida)+"</p></div></div>";$("#devolucao-form").before(e)}}).fail(ErroConnect)}function Associar(a,e){$.ajax({url:a,type:"post",data:e,success:function(s){var t="";1==s.error?t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>":0==s.error&&($(".associacao-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),t='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>"),a=a.replace("associar","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(t)}}).fail(ErroConnect)}function Dissociar(a,e){$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(s){var t="";1==s.error?t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>":0==s.error&&(t='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>"),a=a.replace("dissociar","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(t),$("#modal-desassociar").modal("hide")}}).fail(ErroConnect)}function ErroConnect(a){401==a.status&&location.reload()}function InsertState(a,e,s){$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(s){1==s.error?alert='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>":0==s.error&&(alert='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg+"</div>"),a=a.replace("state","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(alert)}}).fail(ErroConnect).always(s)}function GetState(a,e,s){$.ajax({url:a,type:"get",data:e,dataType:"json",success:function(a){a.length>0?($("#form-state select").val(a[0].state_id),$("#form-state textarea").val(a[0].description),$("#upddated_at").text(a[0].updated)):($("#form-state")[0].reset(),$("#upddated_at").text("Não existe atualizações"))}}).fail(ErroConnect).always(s)}function RemoveKey(a,e,s){$.ajax({url:a,type:"delete",data:e,dataType:"json",success:function(s){var t="";1==s.error?t='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg:0==s.error&&($(".emprestimo-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),t='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+s.msg),a=a.replace("licencas","ativos"),a=a.replace("produto","search"),a=a.replace("delete",""),updatesearch(a,{pat:e.pat,emp:e.emp}),$("#search").after(t)}}).fail(ErroConnect).always(s)}function updatesearch(a,e){$.ajax({url:a,data:e,type:"get",dataType:"json"}).done(handleData).fail(ErroConnect)}function DateUsTODateBr(a){var e=new Date(a);return e.toLocaleDateString()}