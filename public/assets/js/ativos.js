function handleData(a){if($("#resultOfSearch").empty(),a.data.length>0)$.each(a.data,function(a,e){var t="",s="",o="",l="",n="",i="";null!=e.connect&&(s='<button type="button" class="close glyphicon glyphicon-file termos-modal" data-dismiss="alert" aria-label="Close" data-toggle="tooltip" data-placement="left" title="Tooltip on left"><span aria-hidden="true"></span></button><p><b>Colaborador:</b>'+e.connect[0].value+" <b>Matrícula:</b>  "+e.connect[0].id+"  <b>Situação:</b> "+e.connect[0].DESSIT+"</p><div style='display: none'><span class='assoc-numemp'>"+e.connect[0].NUMEMP+"</span><span class='assoc-sitafa'>"+e.connect[0].SITAFA+"</span><span class='assoc-tipcol'>"+e.connect[0].TIPCOL+"</span><span class='assoc-id'>"+e.connect[0].id+"</span> </div> ");var r=null;e.history.length>0?(r='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">',$.each(e.history,function(a,e){d="<div class='panel panel-default'><div class='panel-heading' role='tab' id='headin"+e.id+"'><h4 class=\"panel-title\"><a role='button' data-toggle='collapse'  href='#"+e.id+"' aria-expanded='true' aria-controls='"+e.id+"'>"+e.Employed.value+"</a></h4></div><div id='"+e.id+'\' class="panel-collapse collapsing" role="tabpanel" aria-labelledby=\'headin'+e.id+'\'><div class="panel-body"><p>Funcionário: '+e.Employed.value+" Matrícula: "+e.Employed.id+"</p><p>Data associação: "+e.data_in+" Data dissociação:"+e.data_out+" </p><p>Observação de associação:"+e.obs_in+"</p><p>Observação de dissociação:"+e.obs_in+"</p></div></div></div>",r+=d}),r+="</div>"):r="<p>Sem histórico de associações.</p>",s+=r,o=0==e.state.length?'<button type="button" class="close glyphicon glyphicon-pencil status-ben" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button><p><b>Estado:</b>Sem definição</p><p><b>Descrição:</b>Sem definição</p>':'<button type="button" class="close glyphicon glyphicon-pencil status-ben" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button><p><b>Estado:</b>'+e.state[0].state+"</p><p><b>Descrição:</b>"+e.state[0].description+"</p><p><b>Observação:</b>"+e.state[0].desc+"</p>",0==e.keys.length?l="<p>Nenhuma licença associada</p>":(l='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">',$.each(e.keys,function(a,e){vencimento="Vitalício",null!=e.maturity_date&&(vencimento=DateUsTODateBr(e.maturity_date)),l+="<div class='panel panel-default'><div class='panel-heading' role='tab' id='headin"+e.id+"'><h4 class=\"panel-title\"><a role='button' data-toggle='collapse'  href='#"+e.id+"' aria-expanded='true' aria-controls='"+e.id+"'>"+e.name+"/"+e.model+"</a></h4></div><div id='"+e.id+'\' class="panel-collapse collapsing" role="tabpanel" aria-labelledby=\'headin'+e.id+"'><div class=\"panel-body\"><span class='idkey' style='display: none' >"+e.keyid+"</span><b>Chave:</b>"+e.key+"  - <b>QTD</b> :"+e.quantity+"/<b>Em uso: </b>"+e.in_use+"<b> - Vencimento: </b>"+vencimento+" <button class='btn btn-xs remove-key' title='Dissociar o item da licença.' ><span class='glyphicon glyphicon-resize-full'></span> </button></div></div></div>"}),l+="</div>"),0==e.HISTEMPRST.length?t="<p>Item não tem hístorico de emprestimo</p>":(t='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">',$.each(e.HISTEMPRST,function(a,e){t+="<div class='panel panel-default'><div class='panel-heading' role='tab' id='headin"+e.id+"'><h4 class=\"panel-title\"><a role='button' data-toggle='collapse'  href='#"+e.id+"' aria-expanded='true' aria-controls='headin"+e.id+"'>"+e.employed.NUMCAD+"/"+e.employed.NOMFUN+"</a></h4></div><div id='"+e.id+'\' class="panel-collapse collapsing" role="tabpanel" aria-labelledby=\'headin'+e.id+'\'><div class="panel-body"><p>Data emprestimo: '+DateUsTODateBr(e.data_saida,!0)+"</p><p>Data data devolução: "+DateUsTODateBr(e.data_saida,!0)+"</p></div></div></div>"}),t+="</div>"),n+=e.ASSOC?'<button class="btn btn-danger dissociar-colaborador" type="button"><span class=\'glyphicon glyphicon-user\'></span> Desassociar</button>':1==e.EMPRST?'<button class="btn btn-default associar-colaborador" type="button" disabled><span class=\'glyphicon glyphicon-user\'></span> Associar</button>':'<button class="btn btn-default associar-colaborador" type="button"><span class=\'glyphicon glyphicon-user\'></span> Associar</button>',i=0==e.EMPRST&&0==e.ASSOC?'<button class="btn btn-success emprestimo" type="button"><span class=\'glyphicon glyphicon-transfer\'></span> Emprestimo</button>':1==e.ASSOC?'<button class="btn btn-success emprestimo" type="button" disabled><span class=\'glyphicon glyphicon-transfer\'></span> Emprestimo</button>':'<button class="btn btn-warning devolucao" type="button"><span class=\'glyphicon glyphicon-retweet\'></span> Devolução</button>';var d='<div class="panel panel-default"><div class="panel-heading cod-bem">'+e.CODBEM+"</div><div class='result-emp' style='display: none'>"+e.CODEMP+'</div><div class="panel-body"><p><b>Descrição</b><p><b>Data Aquisição:</b> '+e.DATAQI+" </p><p><b>Item:</b> "+e.DESBEM+" </p><p><b>Descrição:</b> "+e.DESESP+" </p><p><b>Empresa:</b> "+e.NOMEMP+" </p><p><b>Centro Custo:</b> "+e.CODCCU+" - "+e.DESCCU+" </p><hr><p><b>Estado do bem</b>"+o+"<hr><p><b>Associações</b>"+s+"<hr><p><b>Histórico de emprestimos</b>"+t+"<hr><p><b>Licenças associadas</b>"+l+'</div><div class=\'panel-footer\'> <div class="btn-group"><button class="btn btn-primary localizacoes" type="button"><span class=\'glyphicon glyphicon-map-marker\'></span>Localizações</button>'+n+i+"</div></div></div>";$("#resultOfSearch").append(d)}),$("#buttonSearch").empty(),$("#buttonSearch").append('<span class="glyphicon glyphicon-search"></span> Pesquisar'),Result="<p>Total:"+a.total+" exibindo:"+a.per_page+"</p>",$(".navegation").empty(),$(".navegation").append(Result),$(".navegation").fadeIn();else{$("#buttonSearch").empty(),$("#buttonSearch").append('<span class="glyphicon glyphicon-search"></span> Pesquisar');var e='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> Nenhum item encontrado!</div>';$("#resultOfSearch").append(e),$(".navegation").fadeOut()}}function historyLocations(a,e,t){$("#historicoLocalizacoes").empty(),$.each(a.Locations,function(a,e){var t='<div class="panel panel-default"><div class="panel-body"><p><b>Data Aquisição:</b> '+e.DATLOC+" </p><p><b>Descrição:</b> "+e.DESLOC+" </p></div></div>";$("#historicoLocalizacoes").append(t)}),$("#historyFinancialList").empty(),$.each(a.MovFinancial,function(a,e){var t='<div class="panel panel-default"><div class="panel-body"><p><b>Data Movimentação:</b> '+e.DATMOV+" </p><p><b>Descrição:</b> "+e.DESTNS+" </p><p><b>Centro Custo:</b> "+e.CODCCU+" </p></div></div>";if(90804==e.CODTNS){var s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> Esse item foi vendido!.</div>';$("#search").after(s)}90815!=e.CODTNS&&$("#historyFinancialList").append(t)})}function Emprestimo(a,e){$("#loading").modal("show"),$.ajax({url:a,data:e,type:"post",dataType:"json",success:function(t){var s="";1==t.erro?s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg:0==t.erro&&($(".emprestimo-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),s='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg),a=a.replace("emprestimo","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(s)},complete:function(){$("#loading").modal("hide")}}).fail(ErroConnect)}function Devolucao(a,e){$("#loading").modal("show"),$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(t){var s="";1==t.error?s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>":0==t.error&&($(".devolucao-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),s='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>"),a=a.replace("devolucao","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(s)},complete:function(){$("#loading").modal("hide")}}).fail(ErroConnect)}function DevolucaoDados(a,e){$.ajax({url:a+"/"+e.codbem+"/"+e.codbememp,type:"get",data:e,dataType:"json",success:function(a){$(".info-devolucao").remove();var e="<div class='panel panel-default info-devolucao'><div class='panel-body'><p><b>Data empréstimo: </b>"+a[0].data_out+"</p><p><b>Colaborador: </b>"+a[0].colaborador.value+"</p><p><b>Situação do colaborador: </b>"+a[0].colaborador.DESSIT+"</p><p><b>Obs saída: </b>"+(""==a[0].obs_saida?"Sem observação":a[0].obs_saida)+"</p></div></div>";$("#devolucao-form").before(e)}}).fail(ErroConnect)}function Associar(a,e){$("#loading").modal("show"),$.ajax({url:a,type:"post",data:e,success:function(t){var s="";1==t.error?s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>":0==t.error&&($(".associacao-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),s='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>"),a=a.replace("associar","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(s)},complete:function(){$("#loading").modal("hide")}}).fail(ErroConnect)}function Dissociar(a,e){$("#loading").modal("show"),$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(t){var s="";1==t.error?s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>":0==t.error&&(s='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>"),a=a.replace("dissociar","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(s),$("#modal-desassociar").modal("hide")},complete:function(){$("#loading").modal("hide")}}).fail(ErroConnect)}function ErroConnect(a){401==a.status&&location.reload()}function InsertState(a,e,t){$.ajax({url:a,type:"post",data:e,dataType:"json",success:function(t){1==t.error?alert='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>":0==t.error&&(alert='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg+"</div>"),a=a.replace("state","search"),updatesearch(a,{pat:e.codbem,emp:e.codbememp}),$("#search").after(alert)}}).fail(ErroConnect).always(t)}function GetState(a,e,t){$.ajax({url:a,type:"get",data:e,dataType:"json",success:function(a){a.length>0?($("#form-state select").val(a[0].state_id),$("#form-state textarea").val(a[0].description),$("#upddated_at").text(a[0].updated)):($("#form-state")[0].reset(),$("#upddated_at").text("Não existe atualizações"))}}).fail(ErroConnect).always(t)}function RemoveKey(a,e,t){$.ajax({url:a,type:"delete",data:e,dataType:"json",success:function(t){var s="";1==t.error?s='<div class="alert alert-danger alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg:0==t.error&&($(".emprestimo-option").addClass("display-emprestismo"),$("#resultOfSearch").removeClass("col-md-4"),$("#resultOfSearch").addClass("col-md-12"),s='<div class="alert alert-success alert-dismissible search" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Atenção!</strong> '+t.msg),a=a.replace("licencas","ativos"),a=a.replace("produto","search"),a=a.replace("delete",""),updatesearch(a,{pat:e.pat,emp:e.emp}),$("#search").after(s)}}).fail(ErroConnect).always(t)}function updatesearch(a,e){$.ajax({url:a,data:e,type:"get",dataType:"json"}).done(handleData).fail(ErroConnect)}function DateUsTODateBr(a,e){var t=new Date(a),s=1==e?t.getHours()+":"+(t.getMinutes()<=9?"0"+t.getMinutes():t.getMinutes()):"";return t.toLocaleDateString()+" "+s}function CreateFilterPat(a){if(CheckFilter=$("#filter").find("#filter-pat"),CheckFilter.length>=1&&$("#filter #filter-pat").remove(),""!=a){var e='<div id="filter-pat" class="alert alert-info" role="alert"><b>Patrimônio</b>: <a href="#" class="alert-link">'+a+'</a><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><span id=\'filter-pat-num\' style=\'display: none\'>'+a+"</span></div>";$("#filter").append(e)}else $("#filter #filter-pat").remove()}function PreLoad(a,e){e=e.split("#"),e.length>1&&(CreateFilterPat(e[1]),data={qtd:$("#displayNumber").val(),pat:e[1],ccu:$("#filter-costcenter-num").text(),employed:{usr:$("#filter-nameemployed-usr").text(),emp:$("#filter-nameemployed-emp").text(),tip:$("#filter-nameemployed-tip").text()}},$.ajax({url:a,data:data,type:"get",dataType:"json"}).done(handleData).fail(ErroConnect))}function getTermos(a){item=document.getElementsByClassName("cod-bem"),codbememp=document.getElementsByClassName("result-emp"),numemp=document.getElementsByClassName("assoc-numemp"),sitafa=document.getElementsByClassName("assoc-sitafa"),tipcol=document.getElementsByClassName("assoc-tipcol"),numcol=document.getElementsByClassName("assoc-id"),bem={coditem:item[0].innerHTML,codemp:codbememp[0].innerHTML},employed={numemp:numemp[0].innerHTML,sitafa:sitafa[0].innerHTML,tipcol:tipcol[0].innerHTML,numcol:numcol[0].innerHTML},$.ajax({url:a,type:"get",data:[bem,employed],datType:"json",success:function(a){$("#list-termos").empty(),0==a.error?$.each(a.data,function(a,e){enviado="Não enviado",e.notification.length>0&&(enviado="Enviado dia "+DateUsTODateBr(e.notification[0].created_at,!0)),devolvido=0!=e.signtermo?"Recebido":"Não recebido",buttonDevolvidoDisabled=0!=e.signtermo?"disabled":"",buttonDevolvido=0!=e.signtermo?' <a title="download termo assinado" target="_blank" href="/termos/download/'+e.id+"-"+e.tipotermo_id+'" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-cloud-download"></span></a>':"",row="",row+='<div class="panel panel-default" style="margin-bottom: 5px"><div class="panel-body"><span class="id-termo" style="display: none">'+e.id+"</span>"+e.tipoTermo.name+" /  "+enviado+","+devolvido+'<div class="row"><div class="col-lg-12"><button title="download de termo gerado" class="btn btn-default notification-termo btn-sm" '+buttonDevolvidoDisabled+' ><span class="glyphicon glyphicon-bullhorn"> <span class="badge">'+e.notificationQtd+'</span></span></button> <button title="upload de termo assinado" class="btn btn-default upload-termo btn-sm"><span class="glyphicon glyphicon-cloud-upload"></span></button> <a target="_blank" href="/termos/download/'+e.id+'" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-cloud-download"></span></a> '+buttonDevolvido+"</div></div></div></div>",$("#list-termos").append(row)}):$("#list-termos").append("<p>"+a.msg+"</p>")}})}function notificationTermo(a,e){$.ajax({url:e+"/"+a,type:"get",datType:"json",success:function(a){a.error?swal("Oops...",a.msg,"error"):(swal("Good job!",a.msg,"success"),getTermos("api/ativos/termos"))}})}angular.module("ativos",["ngMessages"]),angular.module("ativos").controller("termo",function(a,e){e.gerarTermo=function(t){item=angular.element(document.getElementsByClassName("cod-bem")),codbememp=angular.element(document.getElementsByClassName("result-emp")),numemp=angular.element(document.getElementsByClassName("assoc-numemp")),sitafa=angular.element(document.getElementsByClassName("assoc-sitafa")),tipcol=angular.element(document.getElementsByClassName("assoc-tipcol")),numcol=angular.element(document.getElementsByClassName("assoc-id")),bem={coditem:item[0].innerHTML,codemp:codbememp[0].innerHTML},employed={numemp:numemp[0].innerHTML,sitafa:sitafa[0].innerHTML,tipcol:tipcol[0].innerHTML,numcol:numcol[0].innerHTML},e.novoTermo.tipo.$error.required||a.post("ativos/termo/novo",[t,bem,employed]).then(function(a){a.data.error?angular.element(swal("Oops...",a.data.msg,"error")):(angular.element(swal("Good job!",a.data.msg,"success")),getTermos("api/ativos/termos"))})}}),angular.module("ativos").controller("dataSearch",function(a,e){});